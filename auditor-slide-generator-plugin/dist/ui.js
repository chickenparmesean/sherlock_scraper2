(()=>{"use strict";let e=[],t=[],n="3",o=!1,a=null;function s(){const n=document.getElementById("logoGrid");if(!n)return;const o=document.getElementById("logoSearch").value.toLowerCase(),a=e.filter(e=>e.name.toLowerCase().includes(o)||e.category.toLowerCase().includes(o));n.innerHTML=a.map(e=>`\n    <div class="logo-item ${t.find(t=>t.id===e.id)?"selected":""}" \n         onclick="toggleLogoSelection(${JSON.stringify(e).replace(/"/g,"&quot;")})">\n      <img src="${e.url}" alt="${e.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik0yMCAyMEM5LjQ5IDIwIDIwIDkuNDkgMjAgMjBaIiBmaWxsPSIjQ0NDIi8+Cjx0ZXh0IHg9IjIwIiB5PSIyNSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzk5OSI+TG9nbzwvdGV4dD4KPHN2Zz4K'" />\n      <div class="name">${e.name}</div>\n      <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); deleteLogo('${e.id}')" style="margin-top: 4px;">\n        üóëÔ∏è\n      </button>\n    </div>\n  `).join("")}function i(){const e=document.getElementById("logoCounter");e&&(e.textContent=`${t.length} selected`)}function l(e){if(!e.type.match(/^image\/(png|svg\+xml|jpeg)$/))return void d("Please upload PNG, SVG, or JPEG files only","error");const t=new FileReader;t.onload=t=>{var n;const o=prompt("Enter logo name:",e.name.replace(/\.[^/.]+$/,""));if(!o)return;const a=prompt("Enter logo category (e.g., DeFi, Exchange):","DeFi")||"DeFi";g({type:"save-logo",data:{id:Date.now().toString(36)+Math.random().toString(36).substr(2),name:o,url:null===(n=t.target)||void 0===n?void 0:n.result,category:a}})},t.readAsDataURL(e)}function d(e,t){const n=document.getElementById("status");n&&(n.className=`status ${t}`,n.textContent=e,n.classList.remove("hidden"))}function r(e){const t=document.getElementById("generateBtn");t&&(t.disabled=e,t.textContent=e?"üîÑ Generating...":"üé® Generate Slide")}function c(e){const t=document.getElementById("progressContainer"),n=document.getElementById("progressFill");t&&n&&(t.classList.remove("hidden"),n.style.width=`${e}%`)}function g(e){parent.postMessage({pluginMessage:e},"*")}document.addEventListener("DOMContentLoaded",()=>{console.log("üé® Auditor Slide Generator UI loaded"),g({type:"load-logo-database"}),document.querySelectorAll(".collapsible").forEach(e=>{e.addEventListener("click",()=>{e.classList.toggle("collapsed")})}),function(){const e=document.createElement("input");e.type="file",e.accept=".png,.svg,.jpg,.jpeg",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&l(n)}),window.fileInput=e}()}),window.onmessage=n=>{const{type:l,message:g,data:u}=n.data.pluginMessage||{};switch(l){case"status":d(g,"loading"),function(){var e;const t=["Starting slide generation...","Template validated. Fetching auditor data...","Auditor data loaded","Creating slide...","Updating text content...","Placing logos...","Replacing profile image..."],n=(null===(e=document.getElementById("status"))||void 0===e?void 0:e.textContent)||"",o=t.findIndex(e=>n.includes(e.split(".")[0]));c(o>=0?(o+1)/t.length*90:50)}();break;case"success":d(g,"success"),r(!1),c(100),o=!1,i();break;case"error":d(g,"error"),r(!1),function(){const e=document.getElementById("progressContainer");e&&e.classList.add("hidden")}(),o=!1;break;case"template-analysis":!function(e){const t=document.getElementById("templateAnalysis");if(!t)return;let n=`\n    <div class="analysis-result">\n      <h4>üìã Template Analysis: ${e.frameName}</h4>\n      \n      <div style="margin: 8px 0;">\n        <strong>üìù Text Layers (${e.textNodes.length} found):</strong>\n        ${e.textNodes.slice(0,6).map(e=>`\n          <div class="analysis-item">\n            <strong>${e.name}</strong><br>\n            <em>"${e.content.slice(0,40)}${e.content.length>40?"...":""}"</em>\n          </div>\n        `).join("")}\n        ${e.textNodes.length>6?`<div class="field-help">...and ${e.textNodes.length-6} more</div>`:""}\n      </div>\n      \n      <div style="margin: 8px 0;">\n        <strong>üñºÔ∏è Image Containers (${e.imageNodes.length} found):</strong>\n        ${e.imageNodes.slice(0,4).map(e=>`\n          <div class="analysis-item">\n            <strong>${e.name}</strong> (${e.type})\n          </div>\n        `).join("")}\n        ${e.imageNodes.length>4?`<div class="field-help">...and ${e.imageNodes.length-4} more</div>`:""}\n      </div>\n      \n      <div style="margin: 8px 0;">\n        <strong>üè¢ Logo Containers (${e.logoNodes.length} found):</strong>\n        ${e.logoNodes.map(e=>`\n          <div class="analysis-item">\n            <strong>${e.name}</strong> (${e.type})\n          </div>\n        `).join("")}\n      </div>\n      \n      <div class="field-help" style="margin-top: 8px;">\n        Total nodes: ${e.totalNodes}. Template ready for slide generation!\n      </div>\n    </div>\n  `;t.innerHTML=n,t.classList.remove("hidden")}(u),function(){const e=document.getElementById("status");e&&e.classList.add("hidden")}();break;case"scraper-test-result":!function(e){var t;if(e.success){const n=e.auditorData;d(`‚úÖ Scraper test successful! Found: ${n.name}, ${(null===(t=n.achievements)||void 0===t?void 0:t.earnings)||"N/A"} earnings`,"success")}else d(`‚ùå Scraper test failed: ${e.error}`,"error")}(u);break;case"logo-database-loaded":e=u,s();break;case"logo-saved":e.push(u),s(),d("Logo saved successfully!","success");break;case"logo-deleted":e=e.filter(e=>e.id!==u.logoId),t=t.filter(e=>e.id!==u.logoId),s(),i(),d("Logo deleted successfully!","success");break;case"template-set":a=u.templateName,function(e){const t=document.getElementById("templateInfo"),n=document.getElementById("templateName");t&&n&&(n.textContent=e,t.classList.remove("hidden"))}(u.templateName),d("Template set successfully!","success");break;default:console.log("Unknown message type:",l)}},window.setTemplate=function(){g({type:"set-template"})},window.analyzeTemplate=function(){d("Analyzing template structure...","loading"),g({type:"analyze-template"})},window.testScraper=function(){const e=document.getElementById("auditorUrl").value.trim();e?(d("Testing scraper connection...","loading"),g({type:"test-scraper",data:{auditorUrl:e}})):d("Please enter an auditor URL first","error")},window.generateSlide=function(){if(o)return;const e=document.getElementById("auditorUrl").value.trim(),a=document.getElementById("protocolName").value.trim();if(!e||!a)return void d("Please fill in Auditor URL and Protocol Name","error");const s={subheading:document.getElementById("subheading").value.trim(),description:document.getElementById("description").value.trim(),achievement4:document.getElementById("achievement4").value.trim(),goodfit1:document.getElementById("goodfit1").value.trim(),goodfit2:document.getElementById("goodfit2").value.trim(),goodfit3:document.getElementById("goodfit3").value.trim()};o=!0,r(!0),c(0),g({type:"generate-slide",data:{auditorUrl:e,protocolName:a,manualInputs:s,uiSelectedLogos:t,logoLayout:n}})},window.selectLayout=function(e){var o;n=e,document.querySelectorAll(".layout-option").forEach(e=>{e.classList.remove("selected")}),null===(o=document.querySelector(`[data-layout="${e}"]`))||void 0===o||o.classList.add("selected");const a=parseInt(e);t.length>a&&(t=t.slice(0,a),s(),i())},window.toggleLogoSelection=function(e){const o=parseInt(n),a=t.findIndex(t=>t.id===e.id);if(a>=0)t.splice(a,1);else{if(!(t.length<o))return void d(`Maximum ${o} logos allowed for this layout`,"error");t.push(e)}s(),i()},window.filterLogos=function(){s()},window.uploadLogo=function(){window.fileInput.click()},window.handleLogoDrop=function(e){var t;e.preventDefault(),e.target.classList.remove("dragover");const n=null===(t=e.dataTransfer)||void 0===t?void 0:t.files;n&&n.length>0&&l(n[0])},window.handleLogoDragOver=function(e){e.preventDefault(),e.target.classList.add("dragover")},window.handleLogoDragLeave=function(e){e.target.classList.remove("dragover")},window.deleteLogo=function(e){confirm("Are you sure you want to delete this logo?")&&g({type:"delete-logo",data:{logoId:e}})}})();